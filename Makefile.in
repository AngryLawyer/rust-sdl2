VPATH=%VPATH%

RUSTC ?= rustc
RUSTFLAGS ?=
SDL_PREFIX ?= /usr/local/lib
AR ?= ar
CHMOD ?= chmod
CP ?= cp
LD ?= ld
MV ?= mv
RM ?= rm

RUST_SRC = $(shell find $(VPATH)/src/. -type f -name '*.rs')

.PHONY: all
all: libsdl2.dummy

UNAME=$(shell uname)

ifeq ($(UNAME),Darwin)
  ifeq (%SDL_MODE%,framework)
    RUSTFLAGS+=--cfg mac_framework
  else
    RUSTFLAGS+=--cfg mac_dylib
  endif
endif

libsdl2.dummy: src/sdl2.rc $(RUST_SRC)
	$(RUSTC) $(RUSTFLAGS) $< -o $@
	touch $@

demos: demo/demo.rc libsdl2.dummy
	$(RUSTC) -L . $< -o $@

demo: demos
	./demos

.PHONY: clean
clean:
	rm -f *.so *.dylib *.dll *.dummy demos
	rm -rf *.dSYM

